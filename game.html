document.getElementById("endTurnBtn").addEventListener("click", async () => {
  const endStatus = document.getElementById("endStatus");

  // è¨­å®šè‡ªå·±å·²çµæŸ
  const endRef = ref(db, `rooms/${room}/players/${player}/ended`);
  await update(endRef, true);
  endStatus.textContent = "âœ… ä½ å·²çµæŸä»Šæ—¥å‹•ä½œï¼Œç­‰å¾…å…¶ä»–ç©å®¶...";

  // å–å¾—æ‰€æœ‰ç©å®¶è³‡æ–™
  const playersRef = ref(db, `rooms/${room}/players`);
  const playersSnap = await get(playersRef);
  const players = playersSnap.val() || {};

  // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰äººéƒ½çµæŸ
  let allEnded = true;
  for (let name in players) {
    if (!players[name].ended) {
      allEnded = false;
      break;
    }
  }

  if (allEnded) {
    // âœ… æ‰€æœ‰äººéƒ½çµæŸï¼šæ¯äººåŠ  100 å…ƒä¸¦é‡è¨­ ended
    for (let name in players) {
      const money = players[name].money || 0;
      const playerRef = ref(db, `rooms/${room}/players/${name}`);
      await update(playerRef, {
        money: money + 100,
        ended: false
      });
    }
    endStatus.textContent = "ğŸ‰ æ‰€æœ‰äººçš†å·²çµæŸï¼æ–°çš„ä¸€å¤©é–‹å§‹ï¼Œå·²ç™¼æ”¾ $100";
  }
});
